/*CREATING DATABASE*/
CREATE DATABASE INVENTORY1;
USE INVENTORY1;

/*CREATING SUPPLIER TABLE WITH CONSTRAINTS*/
CREATE TABLE SUPPLIER
(SID CHAR(5),
SNAME VARCHAR(20) NOT NULL,
SADD VARCHAR(50) NOT NULL,
SCITY VARCHAR(20) NOT NULL DEFAULT 'DELHI',
SPHONE VARCHAR(15) NOT NULL UNIQUE,
EMAIL VARCHAR(30) NOT NULL);

/*CALTERING CONSTRAINT IN SID COLUMN*/
ALTER TABLE SUPPLIER
ALTER COLUMN SID CHAR(5) NOT NULL;
ALTER TABLE SUPPLIER
ADD CONSTRAINT PKID PRIMARY KEY (SID);

/*INSERTING VALUES IN SUPPLIER TABLE*/
INSERT INTO SUPPLIER
VALUES('S0001','ANANT SUPPLIERS','NAGAR ROAD JANAKPURI','DELHI','2580258063','ANANT@GAMIL.COM');
INSERT INTO SUPPLIER
VALUES('S0002','HARDIK SUPPLIERS','RAJAOURI GARDEN','DELHI','2580258096','HARDIK01@GAMIL.COM');
INSERT INTO SUPPLIER
VALUES('S0003','HARSHAD IT SUPPLIERS','DLF PHASE 2','GURGAON','9898989521','CHANDRESHIT@GAMIL.COM');
INSERT INTO SUPPLIER
VALUES('S0004','BHAVIN HC SUPPLIERS','SECTOR 78','NOIDA','9874561230','BHAVINHC@GAMIL.COM');
INSERT INTO SUPPLIER
VALUES('S0005','SUNNY HA SUPPLIERS','SECTOR 12 DWARKA','DELHI','9812346075','SUNNYHA@GAMIL.COM');

SELECT* FROM SUPPLIER;

/*CREATING PRODUCT TABLE WITH CONSTRAINTS*/
CREATE TABLE PRODUCT
(PID CHAR(5) NOT NULL,
PDESC VARCHAR(50) NOT NULL,
PRICE INT NOT NULL CHECK(PRICE>0),
CATEGORY VARCHAR(10) NOT NULL CHECK(CATEGORY IN('IT','HA','HC')),
SID CHAR(5) REFERENCES SUPPLIER(SID),
PRIMARY KEY (PID));

/*INSERTING VALUES IN PRODUCT TABLE*/
INSERT INTO PRODUCT
VALUES('P0001','DELL MOUSE',300,'IT','S0001');
INSERT INTO PRODUCT
VALUES('P0002','TVS KEYBOARD',2500,'IT','S0002');
INSERT INTO PRODUCT
VALUES('P0003','DELL MONITOR',10000,'IT','S0003');
INSERT INTO PRODUCT
VALUES('P0004','HP CPU',20000,'IT','S0003');
INSERT INTO PRODUCT
VALUES('P0005','HP PRINTER',15000,'IT','S0002');
INSERT INTO PRODUCT
VALUES('P0006','PATANJALI ALEOVERA GEL',60,'HC','S0004');
INSERT INTO PRODUCT
VALUES('P0007','LUX BODY SOAP',10,'HC','S0004');
INSERT INTO PRODUCT
VALUES('P0008','PONDS FACEWASH',50,'HC','S0004');
INSERT INTO PRODUCT
VALUES('P0009','WHIRLPOOL REFGIGERATOR',30000,'HA','S0005');
INSERT INTO PRODUCT
VALUES('P0010','BOSS GRINDER',2000,'HA','S0005');
INSERT INTO PRODUCT
VALUES('P0011','SAMSUNG WASHING MACHINE',20000,'HA','S0005');
INSERT INTO PRODUCT
VALUES('P0012','PANASONIC MICROWAVE',15000,'HA','S0005');

SELECT * FROM PRODUCT;

/*CREATING CUSTOMER TABLE WITH CONSTRAINTS*/
CREATE TABLE CUSTOMER
(CID CHAR(5) NOT NULL,
CNAME VARCHAR(20) NOT NULL,
ADDRESS VARCHAR(50) NOT NULL,
CITY VARCHAR (15) NOT NULL,
PHONE VARCHAR (15) NOT NULL,
EMAIL VARCHAR(30) NOT NULL,
DOB DATE CHECK(DOB<'01-JAN-2000'),
PRIMARY KEY (CID));

/*INSERTING VALUES IN CUSTOMER TABLE*/
INSERT INTO CUSTOMER
VALUES('C0001','RATAN SHETH','DLF PHASE 1','GURGAON','9852036987','RATAN_SHETH@GMAIL.COM','21-FEB-1996');
INSERT INTO CUSTOMER
VALUES('C0002','SMITH VYAS','RAJOURI GARDEN','DELHI','9852036998','VYASSMITH@GMAIL.COM','05-APRIL-1993');
INSERT INTO CUSTOMER
VALUES('C0003','KAUMIL SHARMA','SECTOR 15 DWARKA','DELHI','9896321478','KAUMIL_SHARMA@GMAIL.COM','20-FEB-1991');
INSERT INTO CUSTOMER
VALUES('C0004','SAGAR GUPTA','SECTOR 20','NOIDA','8632145987','SAGAR01@GMAIL.COM','21-MAY-1991');
INSERT INTO CUSTOMER
VALUES('C0005','CAHNDRESH SHAH','SECTOR 5','NOIDA','9523654896','SHAHCHANDRESH05@GMAIL.COM','05-MAY-1986');


/*ALTERING CONSTRAINT IN COLUMN PHONE IN CUSTOMER TABLE*/
ALTER TABLE CUSTOMER
ADD CONSTRAINT PHN UNIQUE(PHONE);

SELECT* FROM CUSTOMER;

/*CREATING ORDERS TABLE WITH CONSTRAINT*/
CREATE TABLE ORDERS
(OID CHAR(5),
ODATE DATE,
CID CHAR(5) REFERENCES CUSTOMER(CID),
PID CHAR(5) REFERENCES PRODUCT(PID),
OQTY INT CHECK(OQTY>=1),
PRIMARY KEY (OID));

/*INSERTING VALUES IN ORDERS TABLE*/
INSERT INTO ORDERS
VALUES('O0001','21-JAN-2022','C0005','P0002',2);
INSERT INTO ORDERS
VALUES('O0002','20-MARCH-2022','C0003','P0001',25);
INSERT INTO ORDERS
VALUES('O0003','01-APRIL-2022','C0004','P0010',1);
INSERT INTO ORDERS
VALUES('O0004','15-APRIL-2022','C0001','P0007',10);
INSERT INTO ORDERS
VALUES('O0005','30-APRIL-2022','C0002','P0005',1);

SELECT * FROM ORDERS;

/*CREATING STOCK TABLE WITH CONSTRAINT*/
CREATE TABLE STOCK
(PID CHAR(5) REFERENCES PRODUCT(PID),
SQTY INT CHECK(SQTY>=0),
ROL INT CHECK(ROL > 0),
MOQ INT CHECK(MOQ>=5));

/*INSERTING VALUES IN STOCK TABLE*/
INSERT INTO STOCK
VALUES('P0001',1000,10,5);
INSERT INTO STOCK
VALUES('P0002',500,5,5);
INSERT INTO STOCK
VALUES('P0003',300,2,5);
INSERT INTO STOCK
VALUES('P0004',200,1,5);
INSERT INTO STOCK
VALUES('P0005',350,1,5);
INSERT INTO STOCK
VALUES('P0006',500,20,10);
INSERT INTO STOCK
VALUES('P0007',2000,100,50);
INSERT INTO STOCK
VALUES('P0008',100,1,5);
INSERT INTO STOCK
VALUES('P0009',250,5,5);
INSERT INTO STOCK
VALUES('P0010',50,1,5);

SELECT * FROM STOCK;

/* GENERATING BILL WITH VIEW QUERY*/
CREATE VIEW BILL
AS
	SELECT ORDERS.OID,ORDERS.ODATE,CUSTOMER.CNAME,CUSTOMER.ADDRESS,CUSTOMER.PHONE,PRODUCT.PDESC,PRODUCT.PRICE,ORDERS.OQTY,PRICE*OQTY AS 'AMOUNT'
	FROM ORDERS
	INNER JOIN CUSTOMER 
	ON ORDERS.CID=CUSTOMER.CID
	INNER JOIN PRODUCT
	ON ORDERS.PID=PRODUCT.PID;
SELECT * FROM BILL;

/* CREATING USER DEFINED FUNCTION TO GENERATE ALPHA NEUMERIC ID & CAN BE USED MULTIPLE TIMES*/
CREATE FUNCTION GID (@C AS CHAR(1), @X AS INT)
RETURNS CHAR(5)
AS
BEGIN
	DECLARE @ID AS CHAR(5);

	SELECT @ID = CASE	
				WHEN @X <10 THEN  CONCAT(@C, '000', @X)
				WHEN @X <100 THEN  CONCAT(@C, '00', @X)
				WHEN @X <1000 THEN  CONCAT(@C, '0', @X)
				WHEN @X <10000 THEN  CONCAT(@C,  @X)
				ELSE 'NA'
	END;

	RETURN @ID;
END;

/*CREATING SEQUENCE FOR AUTOGENERATION OF INTEGER OF COLUMN SID IN SUPPLIER TABLE*/
CREATE SEQUENCE S1
AS INT
START WITH 6 
INCREMENT BY 1;

/* CREATING PROCEDURE TO INSERT VALUES IN SUPPLIER TABLE WITH AUTO-GENERATION OF COLUMN SID & DISPLAYING DETAILS OF NEW SUPPLIER ADDED*/
CREATE PROCEDURE INSUPPLIER @N AS VARCHAR(20) , @M AS VARCHAR(50), @O AS VARCHAR(20),@P AS VARCHAR(15),@Q AS VARCHAR(30)
AS
BEGIN
	DECLARE @I AS INT;
	DECLARE @ID AS CHAR(5);

	SET @I = (NEXT VALUE FOR S1);

	SET @ID = DBO.GID('S',@I);

	INSERT INTO SUPPLIER	
	VALUES(@ID, @N , @M, @O, @P, @Q);

	SELECT * FROM SUPPLIER;
END;

/*INSERTING VALUES IN SUPPLIER TABLE WITH THE HELP OF PROCEDURE INSUPPLIER*/
INSUPPLIER 'R T SUPPLIERS','SECTOR 11','DELHI','9582695478','RTS@GMAIL.COM'

/*CREATING SEQUENCE FOR AUTOGENERATION OF INTEGER OF COLUMN SID IN PRODUCT TABLE*/
CREATE SEQUENCE S2
AS INT
START WITH 13
INCREMENT BY 1;

/* CREATING PROCEDURE TO INSERT VALUES IN PRODUCT TABLE WITH AUTO-GENERATION OF COLUMN PID & DISPLAYING DETAILS OF NEW PRODUCT ADDED*/
CREATE PROCEDURE INPRODUCT @N AS VARCHAR(50) , @M AS INT, @O AS VARCHAR(10),@P AS VARCHAR(5)
AS
BEGIN
	DECLARE @I AS INT;
	DECLARE @ID AS CHAR(5);

	SET @I = (NEXT VALUE FOR S2);

	SET @ID = DBO.GID('P',@I);

	INSERT INTO PRODUCT	
	VALUES(@ID, @N , @M, @O, @P);

	SELECT * FROM PRODUCT;
END;

/*INSERTING VALUES IN PRODUCT TABLE WITH THE HELP OF PROCEDURE INPRODUCT*/
INPRODUCT 'SONY 32" LED TELEVISION',30000,'HA','S0005';

/*CREATING SEQUENCE FOR AUTOGENERATION OF INTEGER OF COLUMN CID IN CUSTOMER TABLE*/
CREATE SEQUENCE S3
AS INT
START WITH 6
INCREMENT BY 1;

/* CREATING PROCEDURE TO INSERT VALUES IN CUSTOMER TABLE WITH AUTO-GENERATION OF COLUMN CID & DISPLAYING DETAILS OF NEW CUSTOMER ADDED*/
CREATE PROCEDURE INCUSTOMER @N AS VARCHAR(20) , @M AS VARCHAR(50), @O AS VARCHAR(15),@P AS VARCHAR(15),@Q AS VARCHAR(30),@R AS DATE
AS
BEGIN
	DECLARE @I AS INT;
	DECLARE @ID AS CHAR(5);

	SET @I = (NEXT VALUE FOR S3);

	SET @ID = DBO.GID('C',@I);

	INSERT INTO CUSTOMER	
	VALUES(@ID, @N , @M, @O, @P,@Q,@R);

	SELECT * FROM CUSTOMER;
END;

/*INSERTING VALUES IN CUSTOMER TABLE WITH THE HELP OF PROCEDURE INCUSTOMER*/
INCUSTOMER 'RINKU SINGH', 'SECTOR 8', 'NOIDA','8520369745','RINKUS@GMAIL.COM','05-JAN-1986';

/*CREATING SEQUENCE FOR AUTOGENERATION OF INTEGER OF COLUMN OID IN ORDERS TABLE*/
CREATE SEQUENCE S4
AS INT
START WITH 6
INCREMENT BY 1;

/* CREATING PROCEDURE TO INSERT VALUES IN ORDERS TABLE WITH AUTO-GENERATION OF COLUMN OID & DISPLAYING DETAILS OF NEW ORDER ADDED*/
CREATE PROCEDURE INORDER @N AS DATE , @M AS CHAR(5), @O AS CHAR(5),@P AS INT
AS
BEGIN
	DECLARE @I AS INT;
	DECLARE @ID AS CHAR(5);

	SET @I = (NEXT VALUE FOR S4);

	SET @ID = DBO.GID('O',@I);

	INSERT INTO ORDERS	
	VALUES(@ID, @N , @M, @O, @P);

	SELECT * FROM ORDERS;
END;

/*INSERTING VALUES IN ORDERS TABLE WITH THE HELP OF PROCEDURE INORDER*/
INORDER '02-05-2022','C0002','P0006',8
